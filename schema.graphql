enum Risk {
  HIGH_RISK
  MIDDLE_RISK
  LOW_RISK
}

type InfectionAlert {
  howManyEncounters: Int!
  risk: Risk!
}

type Query {
  infectedEncounters(
    deviceHashesOfMyOwn: [DeviceKeyParam!]! # User own device hashes over 2 week period
    optionalEncounters: [EncounterInput!] # If user enabled alerts from infected iOS devices, the need to send all the contact they have been in contact with
  ): [InfectionAlert]!
}

# InfectionCreateKey is generated by the local institute which sees user has tested
# positive this is not tracable to a specific user
type InfectionCreateKey {
  Key: String!
  Password: String!
}

# InfectionCreateKeyInput is sent by user. Scanned by user via QR-code or link via mail
input InfectionCreateKeyInput {
  Key: String!
  Password: String!
}

# Encounter is used for Android devices wo have opt in for iOS alert
# Their encounters would have otherwise stood on their device till they say they are infected
# We do not save these encounters it's only used to find Infected=true DeviceKeys
# iOS users share their infection status with us as stated in the PrivacyStatement
# They can remove always remove their infection status if they still have the app installed
input EncounterInput {
  hash: String!
  rssi: Int!
  hits: Int!
  time: Int!
  duration: Int!
}

# DeviceKeyparams can only be sent by the user owning these keys
# These were synced with the backend from their phone
input DeviceKeyParam {
  hash: String! # hash of random generated id
  password: String! # password of this key to fetch infectedEncounters or to remove
}

input InfectedEncounterCreateInput {
  possibleInfectedHash: String!
  rssi: Int!
  hits: Int!
  time: Int!
  duration: Int!
}

input InfectedEncountersCreateInput {
  infectionCreateKey: InfectionCreateKeyInput!
  infectedEncounters: [InfectedEncounterCreateInput!]!
}

input DeviceKeyCreateInput {
  hash: String!
  password: String!
  time: Int!
}

type OkPayload {
  ok: Boolean!
}

type Mutation {
  # Let Android user share their contactmoments no trace back to user will be saved!
  createInfectedEncounters(input: InfectedEncountersCreateInput!): OkPayload!

  # Let iOS users register their device keys of two weeks as infected
  registerDeviceKeysAsInfected(keys: [DeviceKeyParam!]!): OkPayload!

  # User generated a device key and password so know this uuid really belongs to that user
  createDeviceKey(input: DeviceKeyCreateInput!): OkPayload!

  ## AVG -> User should be able to always remove all their data from server
  # Let user remove infected encounters on their device keys from database (AVG)
  deleteInfectedEncountersOnKeys(keys: [DeviceKeyParam!]!): OkPayload!

  removeDeviceKeys(keys: [DeviceKeyParam!]!): OkPayload!

  ## This is a unique code so user can insert an infection
  ## GGD needs to call this function to generate infection code
  ## TODO: option for sending email or letter
  createInfectionCreateKey(
    singleSignOnKey: String!
    singleSignOnSecondKey: String!
  ): InfectionCreateKey

  # Used for development of app because we don't work yet together with GGD
  createInfectionCreateKeyUnauthorized: InfectionCreateKey
}
